apply plugin: "java"
apply plugin: "maven"
apply plugin: "maven-publish"

group="${buildPackage}" 
version="${buildVersion}"

sourceCompatibility = "${buildCompatibility}" 
targetCompatibility = "${buildCompatibility}"

repositories{
    mavenLocal()
	mavenCentral()
    jcenter()
	maven{ 
		url "${repositoryUrl}"
		credentials{
			username = "${repositoryUser}"
			password = "${repositoryPassword}"
		}
	}
}

sourceSets{
    main{
        java{
            srcDirs "src/main/java"
        }
	    resources{
    	    srcDirs "src/main/resources"
    	}
    }
    test{
        java{
            srcDirs "src/tests/java"
        }
	    resources{
    	    srcDirs "src/tests/resources"
    	}
    }
}

configurations {
  runtime.exclude group: "pull-parser", module: "pull-parser"
}

dependencies{
	compile "org.apache.activemq:activemq-broker:5.15.13"
	compile "org.apache.activemq:activemq-client:5.15.13"
	compile "net.sourceforge.barbecue:barbecue:1.5-beta1"
	compile "commons-fileupload:commons-fileupload:1.4"
	compile "org.apache.commons:commons-jexl3:3.1"
	compile "commons-net:commons-net:3.6"
	compile "org.apache.commons:commons-text:1.8"
	compile "org.dom4j:dom4j:2.1.3"
	compile "com.sun.mail:dsn:1.6.5"
	compile "com.sun.mail:gimap:1.6.5"
	compile "com.google.code.gson:gson:2.8.6"
	compile "org.hibernate.common:hibernate-commons-annotations:5.1.0.Final"
	compile "org.hibernate:hibernate-core:5.4.18.Final"
	compile "org.hibernate:hibernate-ehcache:5.4.18.Final"
	compile "org.hibernate.javax.persistence:hibernate-jpa-2.1-api:1.0.2.Final"
	compile "org.apache.commons:commons-dbcp2:2.7.0"
	compile "org.glassfish.hk2:hk2-api:2.6.1"
	compile "org.glassfish.hk2:hk2-core:2.6.1"
	compile "org.glassfish.hk2:hk2-locator:2.6.1"
	compile "org.glassfish.hk2:hk2-utils:2.6.1"
	compile "org.apache.httpcomponents:httpcore:4.4.13"
	compile "org.apache.httpcomponents:httpcore-nio:4.4.13"
	compile "org.apache.httpcomponents:httpclient:4.5.12"
	compile "com.sun.mail:imap:1.6.5"
	compile "org.glassfish.hk2.external:javax.inject:2.4.0"
	compile "com.lowagie:itext:4.2.2"
	compile "com.fasterxml.jackson.core:jackson-annotations:2.11.1"
	compile "com.fasterxml.jackson.core:jackson-core:2.11.1"
	compile "com.fasterxml.jackson.core:jackson-databind:2.11.1"
	compile "com.fasterxml.jackson.datatype:jackson-datatype-hibernate5:2.11.1"
	compile "com.fasterxml.jackson.jaxrs:jackson-jaxrs-base:2.11.1"
	compile "com.fasterxml.jackson.jaxrs:jackson-jaxrs-json-provider:2.11.1"
	compile "com.fasterxml.jackson.module:jackson-module-jaxb-annotations:2.11.1"
	compile "net.sf.jasperreports:jasperreports:6.12.2"
	compile "com.google.zxing:javase:3.4.0"
	compile "javax.ws.rs:javax.ws.rs-api:2.1.1"
	compile "org.glassfish.jersey.core:jersey-client:2.31"
	compile "org.glassfish.jersey.core:jersey-common:2.31"
	compile "org.glassfish.jersey.inject:jersey-hk2:2.31"
	compile "org.glassfish.jersey.containers:jersey-container-servlet-core:2.31"
	compile "org.glassfish.jersey.media:jersey-media-multipart:2.31"
	compile "net.sf.jmimemagic:jmimemagic:0.1.5"
	compile "javax.servlet:jstl:1.2"
	compile "log4j:log4j:1.2.17"
	compile "com.sun.mail:mailapi:1.6.5"
	compile "mysql:mysql-connector-java:8.0.20"
	compile "org.apache.poi:poi:4.1.2"
	compile "org.apache.poi:poi-ooxml:4.1.2"
	compile "com.sun.mail:pop3:1.6.5"
	compile "com.wcohen:com.wcohen.secondstring:0.1"
	compile "com.sun.mail:smtp:1.6.5"
	compile "com.github.ua-parser:uap-java:1.4.4"
	compile "javax.validation:validation-api:2.0.1.Final"
	compile "javax.servlet.jsp:javax.servlet.jsp-api:2.3.3"
	compile "javax.servlet:javax.servlet-api:4.0.1"
	
    testImplementation "junit:junit:4.13"
}

ext.coreExcludes = []

task modelJar(type: Jar){
	archiveClassifier = "model"
	duplicatesStrategy = "exclude"
    exclude "META-INF/**"
    from(sourceSets.main.output){  
        include "br/com/innovativethinking/framework/**/model/**" 
        project.ext.coreExcludes.addAll(includes)
    }  
}

task controllerJar(type: Jar){
	archiveClassifier = "controller"
	duplicatesStrategy = "exclude"
    exclude "META-INF/**"
    from(sourceSets.main.output){  
        include "br/com/innovativethinking/framework/**/controller/**" 
        project.ext.coreExcludes.addAll(includes)
    }  
}

task persistenceJar(type: Jar){
	archiveClassifier = "persistence"
	duplicatesStrategy = "exclude"
    exclude "META-INF/**"
    from(sourceSets.main.output){  
        include "br/com/innovativethinking/framework/**/persistence/**" 
        project.ext.coreExcludes.addAll(includes)
    }  
}

task serviceJar(type: Jar){
	archiveClassifier = "service"
	duplicatesStrategy = "exclude"
    exclude "META-INF/**"
    from(sourceSets.main.output){  
        include "br/com/innovativethinking/framework/**/service/**" 
        project.ext.coreExcludes.addAll(includes)
    }  
}

task uiJar(type: Jar){
	archiveClassifier = "ui"
	duplicatesStrategy = "exclude"
    exclude "META-INF/**"
    from(sourceSets.main.output){  
        include "br/com/innovativethinking/framework/**/ui/**" 
        project.ext.coreExcludes.addAll(includes)
    }  
}

task resourcesJar(type: Jar){
	archiveClassifier = "resources"
	duplicatesStrategy = "exclude"
    exclude "META-INF/**"
    from(sourceSets.main.output){  
        include "etc/**/*.properties"
        include "etc/**/*.xml"
		include "etc/**/*.xsd"
		project.ext.coreExcludes.addAll(includes)
    }  
}

task coreJar(type: Jar){
	archiveClassifier = "core"
	duplicatesStrategy = "exclude"
    exclude "META-INF/**"
    from(sourceSets.main.output){  
        exclude project.ext.coreExcludes
    }  
}

jar{
    exclude "META-INF/**"
    duplicatesStrategy = 'exclude'
}

task javadocJar(type: Jar){
	archiveClassifier = "javadoc"
    from javadoc
}

artifacts{
	archives modelJar
	archives controllerJar
	archives persistenceJar
	archives serviceJar
	archives uiJar
	archives resourcesJar
	archives coreJar
}

uploadArchives{
    repositories{
        mavenDeployer{
            repository(url: "${repositoryUrl}"){
                authentication(userName: "${repositoryUser}", password: "${repositoryPassword}")
            }
        }
    }
}